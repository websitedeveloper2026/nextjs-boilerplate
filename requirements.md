# 개인 다이어리 웹 애플리케이션 요구 사항 (Requirements)
\n+## 1. 목적 및 범위
- **목적**: 개인 사용자가 일상을 날짜별로 기록하고, 간단히 조회/수정/삭제할 수 있는 다이어리 웹 애플리케이션을 제공한다.
- **범위(초기 버전)**:
  - 날짜 선택 후 **제목 + 본문 텍스트** 입력/저장
  - 저장된 기록의 **조회/수정/삭제**
  - `yyyyMMdd` 값에 따라 **배경 컬러와 텍스트 컬러**를 자동 생성(서로 어울리고 가독성 확보)
  - 데이터 저장소는 **TSV(Tab-Separated Values) 파일**을 사용
\n+## 2. 사용자(Actor)
- **일반 사용자(개인)**: 본인의 다이어리를 작성/관리한다.
\n+## 3. 핵심 사용자 시나리오
1. 사용자가 캘린더/날짜 선택 UI에서 특정 날짜를 선택한다.
2. 선택된 날짜에 대한 다이어리 내용을 확인한다(없으면 빈 상태).
3. 제목과 본문을 입력한 뒤 저장한다.
4. 저장 후 동일 날짜를 다시 열면 저장된 내용이 표시된다.
5. 기존 내용을 수정하여 다시 저장하거나, 기록을 삭제한다.
6. 화면은 선택된 날짜(`yyyyMMdd`)에 의해 결정된 색상 테마(배경/텍스트)로 표시된다.
\n+## 4. 기능 요구 사항 (Functional Requirements)
\n+### 4.1 날짜 선택
- **FR-01**: 사용자는 날짜를 선택할 수 있어야 한다.
- **FR-02**: 선택된 날짜는 내부적으로 `yyyyMMdd`(예: `20260121`) 형태로 정규화되어야 한다.
- **FR-03**: 날짜 변경 시 해당 날짜의 기록을 즉시 로드하여 화면에 반영해야 한다.
\n+### 4.2 다이어리 작성/저장
- **FR-04**: 사용자는 선택된 날짜에 대해 **제목(title)** 과 **본문(content)** 을 입력할 수 있어야 한다.
- **FR-05**: 저장 시 선택된 날짜의 기존 기록이 있으면 **업데이트(덮어쓰기)** 되어야 한다(초기 버전 기본 정책).
- **FR-06**: 저장 성공/실패 상태를 사용자에게 명확히 알려야 한다(예: 토스트/메시지 영역).
\n+### 4.3 조회
- **FR-07**: 선택된 날짜에 저장된 기록이 존재하면 제목/본문을 표시해야 한다.
- **FR-08**: 기록이 없을 경우 “기록 없음” 또는 빈 입력 상태를 표시해야 한다.
\n+### 4.4 수정
- **FR-09**: 사용자는 기존 기록을 수정한 뒤 저장할 수 있어야 한다.
- **FR-10**: 수정 저장 시 데이터 파일에서 해당 날짜의 레코드가 정확히 갱신되어야 한다.
\n+### 4.5 삭제
- **FR-11**: 사용자는 선택된 날짜의 기록을 삭제할 수 있어야 한다.
- **FR-12**: 삭제 시 사용자 확인(Confirm) 절차가 있어야 한다.
- **FR-13**: 삭제 후 해당 날짜 조회 시 기록이 없는 상태로 표시되어야 한다.
\n+### 4.6 색상 자동 생성(테마)
- **FR-14**: `yyyyMMdd` 값으로부터 **배경색(backgroundColor)** 과 **텍스트색(textColor)** 을 자동 생성해야 한다.
- **FR-15**: 동일한 `yyyyMMdd` 입력에 대해 결과 색상은 **항상 동일(결정적, deterministic)** 해야 한다.
- **FR-16**: 생성된 배경/텍스트 색상은 **가독성(충분한 대비)** 을 만족해야 한다.
- **FR-17**: 생성된 배경/텍스트 색상은 **서로 어울리는 조합**이어야 한다(최소 요구: 대비 확보 + 과도한 채도/명도 조합 회피).
\n+#### 4.6.1 색상 생성 규칙(명세)
- 입력: `dateKey` = `yyyyMMdd` 문자열
- 출력:
  - `backgroundColor`: `#RRGGBB`
  - `textColor`: `#RRGGBB`
- 규칙(요구 수준):
  - **결정성**: 해시/시드 기반으로 색상을 생성하되, 같은 `dateKey`는 항상 같은 색상 쌍을 생성한다.
  - **대비**: 텍스트 색상은 배경색과 충분한 대비를 갖도록 선택한다.  
    - 권장: WCAG 대비비율(contrast ratio) \( \ge 4.5:1 \) (일반 텍스트 기준)
  - **텍스트 색상 선택 방식(권장)**:
    - 배경색의 상대 휘도(relative luminance)를 계산하여 흰색/검정 중 대비가 큰 쪽을 선택하거나,
    - 동일 톤을 유지하면서도 대비 기준을 충족하도록 보정한다.
\n+> 참고: “어울리도록”의 정량화가 필요한 경우, 초기 버전에서는 **(1) 결정적 생성 + (2) 대비 충족**을 최소 만족 기준으로 한다.
\n+## 5. 데이터 요구 사항 (TSV 저장)
\n+### 5.1 저장 방식
- **DR-01**: 모든 다이어리 데이터는 서버 측 파일 시스템의 **TSV 파일 1개**에 저장한다.
- **DR-02**: TSV는 탭(`\\t`)으로 컬럼을 구분하고, 레코드는 줄바꿈(`\\n`)으로 구분한다.
- **DR-03**: 애플리케이션은 TSV 파일이 없으면 **자동 생성**할 수 있어야 한다.
\n+### 5.2 파일 위치/이름 (초기 제안)
- **DR-04**: 데이터 파일은 예: `data/diary.tsv` 경로를 사용한다.  
  - (프로덕션 배포 환경에서 파일 쓰기 제약이 있을 수 있으므로, 배포 타겟에 따라 경로는 조정 가능)
\n+### 5.3 스키마(컬럼 정의)
- **DR-05**: TSV 컬럼은 다음을 포함한다.
  1. `dateKey` (string): `yyyyMMdd`
  2. `title` (string): 제목
  3. `content` (string): 본문
  4. `createdAt` (string, ISO 8601): 최초 생성 시각
  5. `updatedAt` (string, ISO 8601): 마지막 수정 시각
\n+### 5.4 이스케이프/정합성 규칙
- **DR-06**: `title`, `content`에는 탭/개행이 포함될 수 있으므로, TSV 저장 시 아래 규칙으로 이스케이프해야 한다.
  - 탭 `\\t` → `\\\\t`
  - 개행 `\\n` → `\\\\n`
  - 역슬래시 `\\` → `\\\\\\\\` (가장 먼저 처리)
- **DR-07**: 로드 시에는 역순으로 언이스케이프해야 한다.
- **DR-08**: `dateKey`는 파일 내에서 **유일 키(Unique)** 로 취급한다(초기 버전 정책).  
  - 동일 `dateKey`가 이미 존재하면 업데이트 시 해당 라인을 교체한다.
\n+### 5.5 동시성/원자성(파일 저장 안전성)
- **DR-09**: 저장/삭제 시 파일 손상을 방지하기 위해 **원자적 쓰기(atomic write)** 를 사용해야 한다.  
  - 예: 임시 파일에 쓴 뒤 rename/replace
- **DR-10**: 동시에 여러 요청이 발생할 경우 데이터 경합을 최소화해야 한다(초기 버전 권장: 서버 단에서 간단한 잠금/큐 처리).
\n+## 6. 화면(UI/UX) 요구 사항
\n+### 6.1 기본 화면 구성
- **UI-01**: 날짜 선택(캘린더 또는 date input) 영역이 있어야 한다.
- **UI-02**: 제목 입력 필드(단일 라인)와 본문 입력 영역(멀티 라인)이 있어야 한다.
- **UI-03**: 저장 버튼이 있어야 한다.
- **UI-04**: 삭제 버튼이 있어야 하며, 삭제는 확인 절차 후 수행한다.
\n+### 6.2 상태/피드백
- **UI-05**: 로딩 중 상태(스켈레톤/스피너 등)를 표시할 수 있어야 한다.
- **UI-06**: 저장 성공/실패, 삭제 성공/실패 메시지를 사용자에게 보여야 한다.
- **UI-07**: 저장되지 않은 변경 사항이 있을 경우, 날짜 이동 시 경고/확인 UX를 제공하는 것을 권장한다(초기 버전에서는 선택 사항).
\n+### 6.3 접근성
- **UI-08**: 텍스트 대비는 최소 기준을 만족해야 한다(색상 자동 생성 요구사항과 연동).
- **UI-09**: 폼 요소에는 적절한 라벨/aria 속성이 제공되어야 한다.
\n+## 7. API/서버 동작(구현 제약 및 요구)
- **SRV-01**: 클라이언트에서 직접 파일 시스템에 쓰지 않고, 서버를 통해 TSV를 읽고/쓴다.
- **SRV-02**: 최소 API:
  - `GET /api/diary?dateKey=yyyyMMdd` (단일 날짜 조회)
  - `PUT /api/diary` (저장/업데이트: `dateKey`, `title`, `content`)
  - `DELETE /api/diary?dateKey=yyyyMMdd` (삭제)
- **SRV-03**: 입력 검증:
  - `dateKey` 형식 검증(정확히 8자리 숫자)
  - `title`, `content` 길이 제한(예: title 1~100, content 0~10000; 초기 값은 조정 가능)
\n+## 8. 비기능 요구 사항 (Non-Functional Requirements)
- **NFR-01 성능**: 단일 사용자 기준, 날짜 조회/저장은 체감 지연 없이 동작해야 한다(권장: 200ms~500ms 내 응답).
- **NFR-02 안정성**: TSV 파일 손상 없이 저장/삭제가 수행되어야 한다(원자적 쓰기).
- **NFR-03 보안/프라이버시**: 개인 기록이므로 기본적으로 외부에 노출되지 않도록 한다(인증/권한은 초기 버전 범위 밖이지만, 공개 배포 시 접근 통제를 고려).
- **NFR-04 유지보수성**: 색상 생성 로직과 TSV 직렬화/역직렬화 로직은 모듈로 분리 가능해야 한다.
\n+## 9. 제약 사항 및 가정
- **C-01**: 저장소는 DB가 아닌 TSV 파일을 사용한다(요구 사항 고정).
- **C-02**: `yyyyMMdd`는 사용자가 선택한 로컬 날짜 기준으로 생성한다(타임존 이슈 최소화).
- **C-03**: 배포 환경에서 파일 쓰기가 제한될 수 있으므로, 운영 환경 요구가 생기면 저장 경로/스토리지 전략은 재검토한다.
\n+## 10. 수용 기준 (Acceptance Criteria)
- **AC-01**: 특정 날짜를 선택하고 제목/본문을 저장하면, 새로고침 후에도 동일 날짜에서 동일 내용이 표시된다.
- **AC-02**: 기존 기록을 수정 후 저장하면 TSV에서 해당 날짜 레코드가 업데이트되고 화면에 반영된다.
- **AC-03**: 기록 삭제 후 해당 날짜에는 기록이 없다고 표시되며 TSV에서도 해당 레코드가 제거된다.
- **AC-04**: 동일 `dateKey`에 대해 배경/텍스트 색상이 항상 동일하게 생성된다.
- **AC-05**: 생성된 텍스트 색상은 배경색 위에서 충분히 읽을 수 있다(대비 기준 충족).
\n+## 11. 향후 확장(Backlog)
- 태그/감정(기분) 선택
- 검색(제목/본문 키워드)
- 내보내기/가져오기(백업)
- 다크 모드/테마 프리셋
- 로그인/암호화 저장

